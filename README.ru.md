# Feedback Bot

Телеграм-бот для обратной связи.

## Использование
Зарегистрируйте нового бота с помощью [@BotFather](https://t.me/botfather).
Скопируйте предоставленный токен в настройку `telegram_bot_token`
и запустите бота. После запуска бота, аутентифицируйтесь как Администратор
с помощью команды `auth` и значения настройки `admin_token`:
```
Вы: /auth <admin-token>
Бот: Auth token successfully verified
```

После этого все сообщения, отправляемые пользователями боту,
будут перенаправлены Администраторам. Администраторы могут отвечать
пользователям, отправляя ответы на их сообщения (нажать на сообщение,
"Ответить"). Профили Администраторов не будут отображаться для пользователей
и сообщения будут отправляться от имени бота.

Бот может перенаправлять сообщения в группы и из групп.
Для этого Администратор после аутентификации должен добавить бот
в группу назначения. **Внимание:** если бот был добавлен в группу
не Администратором, необходимо удалить бот из группы и добавить заново
от имени Администратора. Чтобы позволить участникам группы отвечать
на перенаправленные сообщения, необходимо отключить
[Privacy Mode](https://core.telegram.org/bots#privacy-mode).
Это можно сделать с помощью [@BotFather](https://t.me/botfather).

## Зависимости:
* Python 3.9+;
* Poetry;
* PostgreSQL 13.

## Настройка
Для хранения данных требуется PostgreSQL 13.

Настройка бота может быть выполнена с помощью изменения файла
[settings.toml](settings.toml) или с помощью добавления файла `.secrets.toml`
в корневую директорию проекта (рекомендуется для локального запуска).
Также значения параметров могут быть указаны при помощи переменных окружения.

### Параметры:
* `host` - хост для входящих подключений (по умолчанию `127.0.0.1`);
* `port` - номер порта для входящих подключений (по умолчанию `3000`);
* `telegram_bot_token` - обязательный параметр, токен бота, предоставленный
  [@BotFather](https://t.me/botfather);
* `telegram_webhook_host` - обязательный параметр,
  хост URL для обновлений от Телеграма;
* `telegram_webhook_path` - обязательный параметр,
  путь URL для обновлений от Телеграма;
* `database_url` - URL базы данных (информация о формате может быть найдена
  [здесь](https://www.postgresql.org/docs/13/libpq-connect.html#id-1.7.3.8.3.6));
* `admin_token` - токен Администратора бота (пароль).

Имена переменных окружения для задания параметров могут быть
в верхнем регистре.

## Развёртывание на Heroku
Используйте кнопку ниже, чтобы запустить бот в один клик:

[![Deploy](https://www.herokucdn.com/deploy/button.svg)](https://heroku.com/deploy)
